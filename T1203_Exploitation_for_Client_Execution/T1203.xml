<Sysmon schemaversion="4.90">
  <HashAlgorithms>*</HashAlgorithms>
    <EventFiltering>
        <RuleGroup name="" groupRelation="and">
            <ProcessCreate onmatch="include">
                <!-- Suspicious children of Office apps -->
                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="contains any">cmd.exe;powershell.exe;wscript.exe;cscript.exe;mshta.exe;rundll32.exe;regsvr32.exe</Image>
                    <ParentImage condition="end with">winword.exe;excel.exe;outlook.exe;powerpnt.exe;acrord32.exe;acrobat.exe</ParentImage>
                </Rule>
                <!-- Suspicious children of browsers -->
                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="contains any">cmd.exe;powershell.exe;wscript.exe;cscript.exe;mshta.exe</Image>
                    <ParentImage condition="contains any">chrome.exe;firefox.exe;msedge.exe;brave.exe</ParentImage>  
                </Rule>
            </ProcessCreate>

            <NetworkConnect onmatch="include">
                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="contains any">winword.exe;excel.exe;outlook.exe;powerpnt.exe</Image>  
                    <DestinationPort condition="is any">4444;8080;80</DestinationPort> 
                </Rule>
            </NetworkConnect>

            <ImageLoad onmatch="include">
                <!-- Office & browsers loading unusual DLLs -->
                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="contains any">chrome.exe;firefox.exe;msedge.exe;brave.exe;winword.exe;excel.exe;outlook.exe;powerpnt.exe;acrord32.exe;acrobat.exe</Image>  
                    <Signed condition="is">false</Signed>
                </Rule>
            </ImageLoad>

            <FileCreate onmatch="include">
                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="end with">winword.exe;excel.exe;outlook.exe;powerpnt.exe;acrord32.exe;acrobat.exe</Image>
                    <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
                    <TargetFilename condition="end with">.exe;.dll;.js;.vbs;ps1;.py;.bat</TargetFilename>  
                </Rule>
            </FileCreate>

            <RegistryEvent onmatch="include">
            <!-- Autorun persistence after exploit -->
                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="contains any">cmd.exe;powershell.exe;wscript.exe;cscript.exe;mshta.exe;rundll32.exe;regsvr32.exe</Image>
                    <TargetObject condition="contains">Software\Microsoft\Windows\CurrentVersion\Run</TargetObject>        
                </Rule>

                <Rule name="[T1203]" groupRelation="and">
                    <Image condition="contains any">cmd.exe;powershell.exe;wscript.exe;cscript.exe;mshta.exe;rundll32.exe;regsvr32.exe</Image>
                    <TargetObject condition="contains">RunOnce</TargetObject>
                </Rule>
            </RegistryEvent>  
        </RuleGroup>
    </EventFiltering>
</Sysmon>
